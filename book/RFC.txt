# STXT-SPEC-DRAFT

**Semantic Text (STxT) — Core Language Specification**
**Category:** Standards Track
**Status:** Draft
**Format:** Markdown (RFC-style)

---

# 1. Introducción

Este documento define la especificación del lenguaje **STxT (Semantic Text)**.

STxT es un lenguaje **Human-First**, diseñado para que su forma natural sea legible, clara y cómoda para las personas, manteniendo al mismo tiempo una estructura precisa y fácilmente procesable por máquinas.

STxT es un formato textual jerárquico y semántico orientado a:

* Representar documentos y datos de manera clara.
* Ser extremadamente sencillo de leer y escribir.
* Ser trivial de parsear en cualquier lenguaje.
* Permitir tanto contenido estructurado como texto libre.
* Extender su semántica mediante `@stxt.schema`.

Este documento describe la **sintaxis base** del lenguaje.

---

# 2. Terminología

Las palabras clave **"MUST"**, **"MUST NOT"**, **"SHOULD"**, **"SHOULD NOT"**, y **"MAY"** deben interpretarse según **RFC 2119**.

---

# 3. Codificación del Documento

Los documentos STxT **SHOULD** codificarse en **UTF-8 sin BOM**.

Un parser:

* **MAY** aceptar documentos que comiencen con BOM.
* **SHOULD** emitir una advertencia si aparece.

---

# 4. Unidad Sintáctica: Nodo

Cada línea no vacía del documento define un **nodo**.

Existen dos formas de nodo:

1. **Nodo simple o contenedor**

   ```stxt
   Nombre: ValorInline
   ```

2. **Nodo de bloque textual (`>>`)**

   ```stxt
   Nombre >>
       línea 1
       línea 2
   ```

Un nodo puede incluir opcionalmente un namespace:

```stxt
Nombre (@namespace):
Nombre (@namespace) >>
```

---

# 5. Nodos con `:` (inline o contenedor)

La forma con `:` define un nodo que:

* Puede tener valor inline (opcional).
* Puede no tener valor inline (nodo vacío).
* Puede tener hijos (nodos anidados).
* Su contenido estructurado está compuesto por:

  * La propia línea del nodo.
  * Sus descendientes con mayor indentación, excepto dentro de bloques `>>`.

Ejemplos válidos:

```stxt
Titulo: Informe
Autor: Joan
Nodo:
Nodo: Valor
Nodo:
    SubNodo: 123
```

---

# 6. Nodos con `>>` (bloque textual)

La forma con `>>` define un bloque de **texto literal**.

Ejemplos válidos:

```stxt
Descripcion >>
    Línea 1
    Línea 2
```

```stxt
Seccion>>
    Acepta el operador sin espacio
```

Reglas:

* La línea del nodo `>>` **MUST NOT** contener ningún otro contenido significativo tras `>>` (solo espacios opcionales).
* Todas las líneas con indentación **mayor** que la del nodo `>>` pertenecen al **contenido textual del bloque**.
* Dentro del bloque:

  * El parser **MUST NOT** interpretar líneas como nodos estructurados, aunque contengan `:` o parezcan encabezados.
  * El parser **MUST NOT** interpretar líneas que comienzan por `#` como comentarios; son texto literal.
* El bloque termina cuando aparece una línea **no vacía** con indentación **menor o igual** a la del nodo `>>`.
* Las **líneas vacías dentro del inline** se conservan independientemente del nivel

Ejemplo:

```stxt
Bloque >>
    Texto
        Hijo: valor SI permitido
        Otro hijo: SI permitido
    # Esto también es texto
SiguienteNodo: valor
```

En este ejemplo:

* Todo lo que está indentado por debajo de `Bloque >>` es texto literal.
* `Hijo: valor` y `Otro hijo: SI permitido` **no** son nodos, sino texto del bloque.
* `SiguienteNodo: valor` ya está fuera del bloque `>>`.

---

# 7. Namespaces

Los nodos pueden definir un namespace opcional entre paréntesis:

```stxt
Nodo (@com.example.docs):
```

Reglas:

* Un namespace **MUST** empezar por `@`.
* **SHOULD** seguir formato jerárquico (`@a.b.c`).
* Se hereda por los nodos hijos estructurados.
* El namespace por defecto es **`@stxt`**.

Ejemplo:

```stxt
Documento (@com.demo):
    Autor: Joan
    Texto >>
        Hola mundo
```

---

# 8. Indentación y Jerarquía

La indentación define la jerarquía estructurada del documento.

## 8.1 Indentación Permitida

Un documento STxT:

* **MAY** usar únicamente espacios o únicamente tabuladores.
* **MUST NOT** mezclarlos.
* Si usa espacios:

  * **MUST** usar **4 espacios** por nivel.
* Si usa tabs:

  * Cada tab representa exactamente 1 nivel.

## 8.2 Jerarquía

* La indentación **MUST** aumentar de forma consecutiva (no se permiten saltos de nivel).
* Los nodos hijos **MUST** tener mayor indentación que su padre.
* La indentación dentro de un bloque `>>` **no afecta a la jerarquía estructural**: todo se trata como texto, no como nodos.

---

# 9. Comentarios

Fuera de bloques `>>`, una línea es comentario si, tras su indentación, el primer carácter es `#`.

Ejemplo:

```stxt
# Comentario raíz
Nodo:
    # Comentario interior
    Hijo: valor
```

## 9.1 Comentarios dentro de bloques `>>`

Dentro de un bloque `>>`:

* Cualquier línea cuya indentación sea **igual o mayor** que la indentación mínima del contenido del bloque **MUST** tratarse como **texto literal**, incluso si empieza por `#`.
* Una línea menos indentada que el bloque termina el bloque `>>` y puede ser:

  * Comentario (si empieza por `#`), o
  * Otro nodo.

Ejemplo:

```stxt
Documento:
    Texto >>
        # Esto es texto
        Línea normal
            # También es texto
    # Esto sí es comentario
```

---

# 10. Reglas de Error

Un documento es inválido si ocurre alguna de las siguientes condiciones:

1. Mezcla de espacios y tabuladores.
2. Espacios que no sean múltiplos de 4.
3. Saltos en los niveles de indentación.
4. Un nodo `>>` contiene contenido inline (no vacío) en la misma línea que `>>`.
5. Un nodo no contiene ni `:` ni `>>`.
6. Un namespace no empieza por `@`.
7. Se usa `:` y `>>` simultáneamente en la misma línea de nodo.

Un parser conforme **MUST** rechazar el documento en estos casos.

---

# 11. Conformidad

Una implementación STxT es conforme si:

* Implementa la sintaxis descrita en este documento.
* Aplica reglas estrictas de indentación y jerarquía estructurada.
* Interpreta correctamente nodos con `:` y bloques `>>`.
* Aplica la semántica de comentarios fuera de bloques `>>`.
* Trata todo lo que hay dentro de bloques `>>` como texto literal.
* Rechaza documentos inválidos según la sección 10.

---

# 12. Extensión de Archivo y Media Type

## 12.1 Extensión de Archivo

Los documentos STxT **SHOULD** usar la extensión:

```text
.stxt
```

## 12.2 Media Type (MIME)

Media type preferido:

```text
text/stxt
```

Alternativa compatible:

```text
text/plain
```

---

# 13. Ejemplos Normativos

### 13.1 Documento válido

```stxt
Documento (@com.example.docs):
    Autor: Joan
    Fecha: 03/12/2025
    Resumen >>
        Este es un bloque de texto.
        Con varias líneas.
    Config:
        Modo: Activo
```

### 13.2 Bloque con líneas vacías

```stxt
Texto>>
    
    Línea 2
```

### 13.3 Comentarios dentro y fuera de bloques

```stxt
Documento:
    Cuerpo >>
        # Esto es texto
        Más texto
    # Esto sí es comentario
```

### 13.4 Bloque con “pseudo-hijos” (válido, todo texto)

```stxt
Bloque >>
    Texto
        Hijo: valor SI permitido
        Otro hijo: SI Permitido
    # Esto también es texto
Siguiente: Nodo
```

### 13.5 Inválido: mezcla de indentación

```stxt
A:
    B:
\t\tC: valor
```

---

# 14. Apéndice A — Gramática (Informal)

```text
Nodo             = Indent Nombre NamespaceOpt (InlineOpt | BlockOpt)
NamespaceOpt     = "(" "@" Ident ")" 
InlineOpt        = ":" Esp? TextoInline?
BlockOpt         = Esp? ">>"

TextoInline      = cualquier contenido hasta el fin de línea
BloqueTexto      = una o más líneas indentadas
                   (no se parsean como nodos; son texto literal)

Comentario       = Indent "#" Texto      ; Solo fuera de bloques '>>'

# Regla para comentarios y bloques:
#  - Dentro de un bloque '>>', cualquier línea con indentación >=
#    la mínima del bloque es texto, aunque empiece por '#'.
#  - Una línea menos indentada que el bloque termina el bloque.

Indent           = ("    ")* | ("\t")*
```

---

# 15. Apéndice B — Interacción con @stxt.schema

El sistema de schema permite añadir validación y semántica adicional sin modificar la sintaxis base.

Se expresa en STxT mediante el namespace especial:

```stxt
@stxt.schema
```

Ejemplo:

```stxt
Namespace (@stxt.schema): com.example.docs
    Documento:
        Campo1: (1)
        Campo2: (?)
        Texto: (*)
```

La interpretación de estos valores (cardinalidades, significado, restricciones) es externa al núcleo del lenguaje y depende del sistema de schema.

---

# 16. Fin del Documento
